<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlobalGive.io - Proyectos de Transparencia</title>
    
    <!-- Tailwind CSS CDN para el dise帽o moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuraci贸n personalizada de Tailwind -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'klv-green': '#00B894', // Color Klever o similar
              'klv-dark': '#1C1C1C',
              'klv-blue': '#2152ff',
            },
            fontFamily: {
                sans: ['Inter', 'sans-serif'],
            }
          }
        }
      }
    </script>
    
    <!-- Iconos: Font Awesome (Necesario para otros iconos) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Fuente Inter (para un aspecto moderno) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Estilo para los emojis de bandera para que parezcan m谩s un icono */
        .flag-emoji {
            font-size: 1.25rem; /* Ajuste del tama帽o del emoji */
            line-height: 1;
        }
    </style>

</head>
<body class="bg-gray-50 font-sans antialiased">

    <!-- ============================================== -->
    <!-- BARRA DE NAVEGACIN SUPERIOR (Tailwind) -->
    <!-- ============================================== -->
    <nav class="bg-white shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Logo y Nombre de la App -->
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <!-- RUTA DEL LOGO: Aseg煤rate de que el archivo 'globalgive_logo.png' exista en static/img/ -->
                        <img class="h-8 w-auto mr-2" src="{{ url_for('static', filename='img/globalgive_logo.png') }}" alt="GlobalGive.io Logo">
                    </div>
                    <!-- Enlaces de Navegaci贸n -->
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#" class="text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-klv-blue text-sm font-medium">
                            Inicio
                        </a>
                        <a href="/ranking" class="text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium">
                            Ranking
                        </a>
                        <a href="/swap" class="text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium">
                            Intercambiar
                        </a>
                        <a href="/dashboard" class="text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium">
                            Dashboard
                        </a>
                    </div>
                </div>
                
                <!-- Banderas y Bot贸n de Wallet -->
                <div class="flex items-center space-x-4">
                    <!-- Iconos de Banderas de Idioma usando EMOJIS (soluci贸n robusta) -->
                    <div class="flex space-x-3">
                        <a href="?lang=es" title="Espa帽ol" class="hover:opacity-75 transition duration-150">
                            <span class="flag-emoji" role="img" aria-label="Bandera de Espa帽a"></span>
                        </a>
                        <a href="?lang=en" title="English" class="hover:opacity-75 transition duration-150">
                            <span class="flag-emoji" role="img" aria-label="Bandera de Reino Unido"></span>
                        </a>
                        <a href="?lang=pt" title="Portugu锚s" class="hover:opacity-75 transition duration-150">
                            <span class="flag-emoji" role="img" aria-label="Bandera de Portugal">叼</span>
                        </a>
                        <a href="?lang=uk" title="校泻邪薪泻邪" class="hover:opacity-75 transition duration-150">
                            <span class="flag-emoji" role="img" aria-label="Bandera de Ucrania">吼</span>
                        </a>
                    </div>

                    <button id="connect-wallet-btn" onclick="connectWallet()" class="px-4 py-2 text-sm font-semibold rounded-lg text-white bg-klv-blue hover:bg-klv-blue/90 shadow-lg transition duration-150 ease-in-out">
                        <i class="fas fa-wallet mr-2"></i> Conectar Wallet
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- ============================================== -->
    <!-- CONTENIDO PRINCIPAL -->
    <!-- ============================================== -->
    <main class="py-10">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            
            <!-- Bloque Hero/T铆tulo Principal -->
            <div class="text-center mb-12 px-4">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 leading-tight">
                    Proyectos de Transparencia Global
                </h1>
                <p class="mt-3 text-lg text-gray-600 max-w-2xl mx-auto">
                    Explora y financia proyectos auditables en tiempo real en KleverChain.
                </p>
            </div>

            <!-- Tarjeta de Estado de Conexi贸n (Actualizada) -->
            <div id="initial-status-card" class="mb-12 mx-4 p-5 sm:p-6 bg-white rounded-xl shadow-xl border-t-4 border-klv-blue transition duration-300 ease-in-out">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-info-circle text-2xl text-klv-blue"></i>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">Integraci贸n de Billetera Exitosa</h2>
                        <p class="text-gray-500">La l贸gica de conexi贸n est谩 cargada. Haz clic en el bot贸n "Conectar Wallet" en la barra superior para iniciar la conexi贸n.</p>
                    </div>
                </div>
            </div>

            <!-- CUADRCULA DE PROYECTOS (Similar a la Imagen 2) -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-4">
                
                <!-- Tarjeta 1: Proyectos de Caridad -->
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-klv-blue/10 text-klv-blue p-3 rounded-full mr-4">
                                <i class="fas fa-hand-holding-heart fa-lg"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900">Caridad y Ayuda Humanitaria</h3>
                        </div>
                        <p class="text-gray-600 mb-4">Dona a causas verificadas. Cada KLV gastado es rastreado en tiempo real, garantizando el 100% de transparencia.</p>
                        <a href="javascript:;" class="text-sm font-medium text-klv-blue hover:text-klv-blue/80 flex items-center">
                            Ver Proyectos <i class="fas fa-arrow-right text-xs ml-2"></i>
                        </a>
                    </div>
                </div>

                <!-- Tarjeta 2: Inversiones Sociales -->
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-klv-green/10 text-klv-green p-3 rounded-full mr-4">
                                <i class="fas fa-seedling fa-lg"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900">Inversiones de Impacto Ambiental</h3>
                        </div>
                        <p class="text-gray-600 mb-4">Invierte en proyectos de desarrollo sostenible con rendimientos auditables y transparentes. Triple impacto positivo.</p>
                        <a href="javascript:;" class="text-sm font-medium text-klv-green hover:text-klv-green/80 flex items-center">
                            Ver Proyectos <i class="fas fa-arrow-right text-xs ml-2"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Tarjeta 3: Desarrollo Educativo -->
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-indigo-500/10 text-indigo-500 p-3 rounded-full mr-4">
                                <i class="fas fa-graduation-cap fa-lg"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900">Desarrollo Tecnol贸gico y Educativo</h3>
                        </div>
                        <p class="text-gray-600 mb-4">Financia programas de educaci贸n en blockchain y tecnolog铆a. Creando la pr贸xima generaci贸n de desarrolladores.</p>
                        <a href="javascript:;" class="text-sm font-medium text-indigo-500 hover:text-indigo-500/80 flex items-center">
                            Ver Proyectos <i class="fas fa-arrow-right text-xs ml-2"></i>
                        </a>
                    </div>
                </div>
                
            </div>
            
            <!-- Bot贸n de Call to Action Final -->
            <div class="text-center mt-16 px-4">
                <a href="javascript:;" class="inline-block px-8 py-3 text-lg font-bold text-white bg-klv-blue rounded-xl shadow-xl hover:bg-klv-blue/90 transition duration-300 transform hover:scale-105">
                    Ver Todos los Proyectos
                </a>
            </div>

        </div>
    </main>

    <!-- FOOTER SIMPLE -->
    <footer class="mt-20 py-8 bg-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-gray-400">漏 <script>document.write(new Date().getFullYear())</script> GlobalGive.io. Desarrollado sobre KleverChain.</p>
        </div>
    </footer>


    <!-- ============================================== -->
    <!-- SCRIPT DE CONEXIN DE WALLET (INTEGRADO) -->
    <!-- ============================================== -->
    <script>
        /**
         * L贸gica de conexi贸n Klever Wallet (adaptada para el nuevo dise帽o Tailwind)
         */
        const MAX_RETRIES = 15;
        const RETRY_DELAY_MS = 250;
        const BOOTSTRAP_DELAY_MS = 1000;
        
        const CONNECT_BUTTON = document.getElementById('connect-wallet-btn');
        const STATUS_CARD = document.getElementById('initial-status-card');

        /**
         * Funci贸n utilitaria para actualizar el estado visual de la tarjeta flotante y el bot贸n.
         */
        function updateUI(title, message, type, address = null) {
            if (STATUS_CARD) {
                let iconClass = 'fas fa-info-circle text-klv-blue';
                let borderColor = 'border-klv-blue';
                let textColor = 'text-klv-blue';

                if (type === 'success') {
                    iconClass = 'fas fa-check-circle text-klv-green';
                    borderColor = 'border-klv-green';
                    textColor = 'text-klv-green';
                } else if (type === 'error') {
                    iconClass = 'fas fa-exclamation-triangle text-red-600';
                    borderColor = 'border-red-600';
                    textColor = 'text-red-600';
                }
                
                // Actualizar la tarjeta flotante
                STATUS_CARD.className = `mb-12 mx-4 p-5 sm:p-6 bg-white rounded-xl shadow-xl border-t-4 ${borderColor} transition duration-300 ease-in-out`;
                STATUS_CARD.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <i class="${iconClass} text-2xl ${textColor}"></i>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">${title}</h2>
                            <p class="text-gray-500">${message}</p>
                            ${address ? `<p class="mt-1 text-sm font-semibold text-gray-700">Direcci贸n: ${address}</p>` : ''}
                        </div>
                    </div>
                `;
            }
            
            if (CONNECT_BUTTON) {
                // 2. Actualizar el bot贸n
                CONNECT_BUTTON.className = 'px-4 py-2 text-sm font-semibold rounded-lg text-white shadow-lg transition duration-150 ease-in-out';

                if (type === 'success' && address) {
                    const shortAddress = `${address.substring(0, 4)}...${address.substring(address.length - 4)}`;
                    CONNECT_BUTTON.innerHTML = `<i class="fas fa-check-circle mr-2"></i> ${shortAddress}`;
                    CONNECT_BUTTON.classList.add('bg-klv-dark', 'hover:bg-klv-dark/80');
                    CONNECT_BUTTON.classList.remove('bg-klv-blue');
                    CONNECT_BUTTON.disabled = true;
                } else if (type === 'error') {
                    CONNECT_BUTTON.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i> Error al Conectar`;
                    CONNECT_BUTTON.classList.add('bg-red-600', 'hover:bg-red-600/80');
                    CONNECT_BUTTON.classList.remove('bg-klv-blue');
                    CONNECT_BUTTON.disabled = false;
                } else {
                    // Estado inicial/informaci贸n
                    CONNECT_BUTTON.innerHTML = `<i class="fas fa-wallet mr-2"></i> Conectar Wallet`;
                    CONNECT_BUTTON.classList.add('bg-klv-blue', 'hover:bg-klv-blue/90');
                    CONNECT_BUTTON.classList.remove('bg-klv-dark', 'bg-red-600');
                    CONNECT_BUTTON.disabled = false;
                }
            }
        }


        /**
         * Espera de forma as铆ncrona hasta que window.kleverWeb est茅 disponible.
         */
        async function waitForKleverWeb() {
            // 1. Espera inicial para dar tiempo a la extensi贸n
            await new Promise(resolve => setTimeout(resolve, BOOTSTRAP_DELAY_MS));
            
            console.log(`[KleverChain] Iniciando b煤squeda de la extensi贸n Klever (${MAX_RETRIES} intentos)...`);

            for (let i = 0; i < MAX_RETRIES; i++) {
                if (window.kleverWeb && typeof window.kleverWeb.getAccounts === 'function') {
                    console.log(`[KleverChain] Extensi贸n detectada en el intento ${i + 1}.`);
                    return true;
                }
                await new Promise(resolve => setTimeout(resolve, RETRY_DELAY_MS));
            }
            
            console.error('[KleverChain] ERROR CRTICO: La extensi贸n Klever no fue detectada despu茅s de todos los reintentos.');
            return false;
        }

        /**
         * Intenta conectar a la Klever Wallet.
         */
        async function connectWallet() {
            if (!CONNECT_BUTTON) return;
            
            CONNECT_BUTTON.disabled = true;
            updateUI('Buscando Extensi贸n', 'Buscando Klever Wallet. Puede tomar un momento...', 'info');

            try {
                if (!await waitForKleverWeb()) {
                    throw new Error("Extensi贸n Klever Wallet no detectada. Por favor, aseg煤rate de que est茅 instalada, activa y la p谩gina se haya recargado.");
                }

                updateUI('Solicitando Conexi贸n', 'Por favor, aprueba la conexi贸n en la ventana emergente de Klever Wallet.', 'info');
                
                const accounts = await window.kleverWeb.getAccounts();

                if (accounts && accounts.length > 0) {
                    const walletAddress = accounts[0].address;
                    
                    // Notificar al backend sobre la conexi贸n exitosa (opcional)
                    fetch('/api/user/connect', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ address: walletAddress })
                    }).then(response => {
                        if (response.ok) {
                            console.log("Direcci贸n de Wallet enviada al servidor.");
                        } else {
                             console.error("Fallo al enviar la direcci贸n al servidor.");
                        }
                    }).catch(e => console.error("Error al comunicarse con el servidor:", e));


                    updateUI(
                        '隆Conexi贸n Exitosa!',
                        `Direcci贸n conectada.`,
                        'success',
                        walletAddress
                    );

                } else {
                    updateUI(
                        'Conexi贸n Rechazada', 
                        'El usuario cancel贸 la solicitud o no seleccion贸 una cuenta.', 
                        'error'
                    );
                    CONNECT_BUTTON.disabled = false;
                }

            } catch (error) {
                console.error('[KleverChain] Error al conectar la Wallet:', error);
                
                const displayMessage = (error.message.includes('Extensi贸n Klever Wallet no detectada')) ?
                    'No se pudo encontrar la extensi贸n. Verifica si est谩 instalada y vuelve a cargar la p谩gina.' :
                    `Ocurri贸 un error inesperado. Mensaje: ${error.message}`;
                    
                updateUI(
                    'Fallo de Conexi贸n', 
                    displayMessage, 
                    'error'
                );
                CONNECT_BUTTON.disabled = false;
            }
        }

        // Inicializar el bot贸n y el estado al cargar la ventana
        window.onload = function() {
            if (CONNECT_BUTTON) {
                CONNECT_BUTTON.addEventListener('click', connectWallet);
                updateUI('Listo para Conectar', 'Haz clic en "Conectar Wallet" para buscar la extensi贸n Klever.', 'info');
            } else {
                console.error("Bot贸n 'connect-wallet-btn' no encontrado.");
            }
        };
    </script>

</body>
</html>
